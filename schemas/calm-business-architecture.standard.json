{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "calm-business-architecture.standard.json",
  "title": "CALM with Business Architecture Extensions Meta-Schema",
  "description": "Extensions to provide additional constraints for Business Architecture node types.",
  "allOf": [
    {
      "$ref": "https://calm.finos.org/release/1.0/meta/core.json#/defs/node"
    },
    {
      "type": "object",
      "allOf": [
        {
          "$comment": "Apply Business Architecture-specific constraints based on node-type",
          "if": {
            "properties": {
              "node-type": {
                "enum": [
                  "business-capability",
                  "value-stream",
                  "value-stream-stage",
                  "business-process",
                  "information-concept",
                  "stakeholder",
                  "product",
                  "initiative",
                  "strategy",
                  "objective",
                  "policy",
                  "event",
                  "organization-unit"
                ]
              }
            }
          },
          "then": {
            "$comment": "Business Architecture nodes MUST have description",
            "required": ["unique-id", "node-type", "name", "description"]
          }
        },
        {
          "$comment": "Capability-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "business-capability"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "capability-level"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Business capabilities should be named using a noun-verb structure that combines the deliverable or outcome (noun) with the associated activity (verb). Examples include 'Risk Management', 'Strategy Planning'."
              },
              "description": {
                "type": "string",
                "description": "Concise explanation (1-2 sentences maximum) preferably starting with 'the ability to...' or 'the capacity to...'. Provide meaningful detail rather than simply restating the capability name. For instance, 'Market Risk Management' should describe 'Ability to identify, assess, aggregate, articulate, and incorporate various exposures to harm, danger, or loss associated with a market' rather than just 'the ability to manage market risk'."
              },
              "capability-level": {
                "type": "integer",
                "minimum": 0,
                "maximum": 4,
                "description": "Hierarchical level of the capability (0=top-level, 1-4=increasing decomposition)"
              },
              "parent-capability": {
                "type": "string",
                "description": "Reference to the unique-id of the parent capability node"
              },
              "seq-num": {
                "type": "string",
                "pattern": "^[0-9]+(\\.[0-9]+){0,3}$",
                "description": "Sequence number in the format n.n.n.n (e.g., 1, 1.1, 1.1.2, 1.1.2.3) representing the hierarchical position of the capability"
              },
              "maturity-level": {
                "enum": ["initial", "developing", "defined", "managed", "optimized"],
                "description": "Capability maturity assessment based on standardization and optimization level"
              }
            }
          }
        },
        {
          "$comment": "Value-stream-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "value-stream"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "value"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Value stream names should be expressed from the initiating stakeholder's viewpoint using active voice with a verb-noun structure (opposite of business capability naming). Examples: 'Acquire Retail Product', 'Recruit Employee'."
              },
              "description": {
                "type": "string",
                "description": "Brief, precise explanation that clarifies the scope of activities covered by the value stream, supplementing the self-explanatory name."
              },
              "stakeholder": {
                "type": "string",
                "description": "Reference to the unique-id of the primary stakeholder that initiates or benefits from the value stream."
              },
              "value": {
                "type": "string",
                "description": "The expected outcome or benefit from the stakeholder's perspective when the value stream completes successfully. This represents the cumulative value delivered across all stages of the value stream."
              }
            }
          }
        },
        {
          "$comment": "Value-stream-stage-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "value-stream-stage"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "parent-value-stream"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Value stream stage names should describe a distinct phase or step in the value stream using active voice with a verb-noun structure. Examples: 'Validate Application', 'Assess Credit Risk', 'Approve Loan'."
              },
              "description": {
                "type": "string",
                "description": "Clear explanation of what occurs during this stage, the inputs required, outputs produced, and any key decision points or transformation activities."
              },
              "parent-value-stream": {
                "type": "string",
                "description": "Reference to the unique-id of the parent value stream that this stage is part of."
              },
              "stage-order": {
                "type": "integer",
                "minimum": 1,
                "description": "Sequential position of this stage within the parent value stream (1=first stage)."
              },
              "stage-value": {
                "type": "string",
                "description": "The specific value or outcome delivered upon completion of this stage, contributing to the overall value stream value."
              }
            }
          }
        },
        {
          "$comment": "Information-concept-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "information-concept"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "metadata"],
            "properties": {
              "metadata": {
                "anyOf": [
                  {
                    "type": "object",
                    "required": ["data-classification"],
                    "properties": {
                      "data-classification": {
                        "enum": ["public", "internal", "confidential", "restricted"]
                      },
                      "data-owner": {
                        "type": "string"
                      },
                      "retention-period": {
                        "type": "string"
                      }
                    }
                  },
                  {
                    "type": "array",
                    "contains": {
                      "required": ["data-classification"]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "$comment": "Stakeholder-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "stakeholder"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "metadata"],
            "properties": {
              "metadata": {
                "anyOf": [
                  {
                    "type": "object",
                    "required": [],
                    "properties": {
                      "stakeholder-type": {
                        "enum": ["internal", "external-customer", "external-partner", "external-regulator"]
                      }
                    }
                  },
                  {
                    "type": "array",
                    "contains": {
                      "required": []
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "$comment": "Organization-unit-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "organization-unit"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "level", "business-unit-type"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the organizational unit."
              },
              "description": {
                "type": "string",
                "description": "Description of the organizational unit's purpose and responsibilities."
              },
              "level": {
                "type": "integer",
                "minimum": 0,
                "description": "Hierarchical level of the organizational unit (0=top-level, higher numbers=deeper in hierarchy)"
              },
              "business-unit-type": {
                "enum": ["enterprise", "business unit", "partner", "collaborative team"],
                "description": "Type of organizational unit"
              },
              "parent-unit": {
                "type": "string",
                "description": "Reference to the unique-id of the parent organizational unit"
              }
            }
          }
        }
      ]
    }
  ],
  "defs": {
    "maps-to-type": {
      "type": "object",
      "description": "Represents a mapping relationship where a source node (typically a value stream stage) maps to one or more target nodes (typically business processes) that realize or implement that stage.",
      "properties": {
        "source": {
          "type": "string",
          "description": "The unique-id of the source node (e.g., value-stream-stage) that maps to the target nodes."
        },
        "targets": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          },
          "description": "Array of unique-ids of the target nodes (e.g., business-process) that the source maps to."
        }
      },
      "required": [
        "source",
        "targets"
      ]
    }
  }
}
