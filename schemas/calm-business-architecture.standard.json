{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "calm-business-architecture.standard.json",
  "title": "CALM with Business Architecture Extensions Meta-Schema",
  "description": "Extensions to provide additional constraints for Business Architecture node types.",
  "allOf": [
    {
      "$ref": "https://calm.finos.org/release/1.0/meta/core.json#/defs/node"
    },
    {
      "type": "object",
      "allOf": [
        {
          "$comment": "Apply Business Architecture-specific constraints based on node-type",
          "if": {
            "properties": {
              "node-type": {
                "enum": [
                  "business-capability",
                  "value-stream",
                  "business-process",
                  "information-concept",
                  "stakeholder",
                  "product",
                  "initiative",
                  "strategy",
                  "objective",
                  "policy",
                  "event",
                  "organization-unit"
                ]
              }
            }
          },
          "then": {
            "$comment": "Business Architecture nodes MUST have description",
            "required": ["unique-id", "node-type", "name", "description"]
          }
        },
        {
          "$comment": "Capability-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "business-capability"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "capability-level"],
            "properties": {
              "name": {
                "type": "string",
                "description": "The naming convention is to express the business capability in a noun-verb format where each outcome (input, output, or deliverable) is described as a noun and each activity that is associated with producing, controlling or monitoring the outcome is described as a verb e.g., “Risk Management”, “Strategy Planning”."
              },
              "description": {
                "type": "string",
                "description": "Ideally 1 (or max 2) sentences. The recommended syntax to describe each business capability is “the ability [or capacity] to …”. For example, the business capability “Market Risk Management” can be described as “Ability to identify, assess, aggregate, articulate, and incorporate various exposures to harm, danger, or loss associated with a market.” Be concise and precise - do not simply repeat the name of the capability in the description, such as “the ability to manage projects” when describing “Project Management”. Instead use a description that has more explanation such as “Ability to plan, execute, monitor projects from inception to completion”."
              },
              "capability-level": {
                "type": "integer",
                "minimum": 0,
                "maximum": 4,
                "description": "Hierarchical level of the capability (0=top-level, 1-4=increasing decomposition)"
              },
              "parent-capability": {
                "type": "string",
                "description": "Reference to the unique-id of the parent capability node"
              },
              "seq-num": {
                "type": "string",
                "pattern": "^[0-9]+(\\.[0-9]+){0,3}$",
                "description": "Sequence number in the format n.n.n.n (e.g., 1, 1.1, 1.1.2, 1.1.2.3) representing the hierarchical position of the capability"
              },
              "maturity-level": {
                "enum": ["initial", "developing", "defined", "managed", "optimized"],
                "description": "Capability maturity assessment based on standardization and optimization level"
              }
            }
          }
        },
        {
          "$comment": "Value-stream-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "value-stream"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "value-stream-type"],
            "properties": {
              "value-stream-type": {
                "enum": ["operational", "development", "customer-facing", "support"]
              },
              "cycle-time": {
                "type": "string"
              },
              "customer-segment": {
                "type": "string"
              }
            }
          }
        },
        {
          "$comment": "Information-concept-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "information-concept"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "metadata"],
            "properties": {
              "metadata": {
                "anyOf": [
                  {
                    "type": "object",
                    "required": ["data-classification"],
                    "properties": {
                      "data-classification": {
                        "enum": ["public", "internal", "confidential", "restricted"]
                      },
                      "data-owner": {
                        "type": "string"
                      },
                      "retention-period": {
                        "type": "string"
                      }
                    }
                  },
                  {
                    "type": "array",
                    "contains": {
                      "required": ["data-classification"]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "$comment": "Stakeholder-specific constraints",
          "if": {
            "properties": {
              "node-type": {
                "const": "stakeholder"
              }
            }
          },
          "then": {
            "required": ["unique-id", "node-type", "name", "description", "metadata"],
            "properties": {
              "metadata": {
                "anyOf": [
                  {
                    "type": "object",
                    "required": [],
                    "properties": {
                      "stakeholder-type": {
                        "enum": ["internal", "external-customer", "external-partner", "external-regulator"]
                      }
                    }
                  },
                  {
                    "type": "array",
                    "contains": {
                      "required": []
                    }
                  }
                ]
              }
            }
          }
        }
      ]
    }
  ]
}
